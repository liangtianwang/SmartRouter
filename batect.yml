containers:
  build-env-framework:
    build_directory: .batect/build-env-framework
    working_directory: c:\code
    volumes:
      # This is equivalent to .:/code:cached
      - local: .
        container: c:\code

tasks:
  build:
    description: Build Smart Router solution
    run:
      container: build-env-framework
      command: dotnet build -c Release

  testRun:
    description: Run Smart Router Test
    run:
      container: build-env-framework
      command: dotnet test SmartRouterTest -c Release --logger "console;verbosity=detailed" /p:CollectCoverage=true /p:CoverletOutputFormat=opencover /p:CoverletOutput=..\\coverlet\\coverage.xml

  test:
    description: Run test & generate report
    prerequisites:
      - testRun
    run:
      container: build-env-framework
      command: reportgenerator "-reports:coverlet/coverage.xml" "-targetdir:coverlet" -reporttypes:HTML